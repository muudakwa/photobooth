<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Photobooth Strip</title>

<style>
body{
    background:black;
    color:white;
    text-align:center;
    font-family:Arial;
}

video{
    width:320px;
    border-radius:15px;
}

#countdown{
    font-size:60px;
    margin:10px;
}

canvas{
    display:none;
}

#result{
    margin-top:20px;
}
</style>
</head>

<body>

<h2>ðŸ“¸ Photobooth Strip</h2>

<video id="video" autoplay></video>

<div id="countdown"></div>

<button onclick="start()">Mulai Foto</button>

<br><br>

<canvas id="canvas"></canvas>

<img id="result" width="250">

<br>
<a id="download" style="display:none">Download</a>

<script>

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const countdownEl = document.getElementById("countdown");
const resultImg = document.getElementById("result");
const downloadLink = document.getElementById("download");

let photos = [];

navigator.mediaDevices.getUserMedia({video:true})
.then(stream => video.srcObject = stream);

function start(){
    photos = [];
    ambilFoto(0);
}

function ambilFoto(index){

    if(index >= 3){
        gabungStrip();
        return;
    }

    let count = 3;
    countdownEl.innerText = count;

    let timer = setInterval(()=>{
        count--;
        countdownEl.innerText = count;

        if(count == 0){
            clearInterval(timer);
            countdownEl.innerText = "";

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            ctx.drawImage(video,0,0);
            photos.push(canvas.toDataURL());

            ambilFoto(index + 1);
        }

    },1000);
}

function gabungStrip(){

    const stripCanvas = document.createElement("canvas");
    const stripCtx = stripCanvas.getContext("2d");

    const img = new Image();

    img.onload = () => {

        stripCanvas.width = img.width;
        stripCanvas.height = img.height * photos.length;

        photos.forEach((p,i)=>{
            let im = new Image();
            im.src = p;
            im.onload = ()=>{
                stripCtx.drawImage(im,0,i*img.height);
            };
        });

        setTimeout(()=>{
            let final = stripCanvas.toDataURL();

            resultImg.src = final;

            downloadLink.href = final;
            downloadLink.download = "photobooth.png";
            downloadLink.innerText = "Download Strip";
            downloadLink.style.display = "block";

        },1000);

    };

    img.src = photos[0];
}

</script>

</body>
</html>